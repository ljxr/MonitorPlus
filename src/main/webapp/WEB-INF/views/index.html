<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>安吉国源智慧水务综合管理平台</title>
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <link rel="stylesheet" href="${request.contextPath}/statics/css/bootstrap.min.css">
  <link rel="stylesheet" href="${request.contextPath}/statics/css/font-awesome.min.css">
  <link rel="stylesheet" href="${request.contextPath}/statics/css/AdminLTE.min.css">
  <link rel="stylesheet" href="${request.contextPath}/statics/css/all-skins.min.css">
  <link rel="stylesheet" href="${request.contextPath}/statics/css/main.css">
  <link rel="stylesheet" href="${request.contextPath}/statics/plugins/layui/css/layui.css">
  	<meta http-equiv="pragram" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
	<meta http-equiv="expires" content="0">
  <style type="text/css">
  	#lay{width:350px; height:200px; padding:10px;}
  	.layui-layer-setwin .layui-layer-close1 {
		color:#ffffff;
		cursor: pointer
	}
	.tipName{font-size:22px; line-height:36px; text-align:left;}
	.alarm{font-size:16px; line-height:36px; text-align:left; height:50px; line-height:50px;}
	.alarm a{display:inline-block;}
	.alarm .alarm1{font-size:20px;}
	.alarm .alarm2{font-size:34px; color:#f00;}
	.alarm .alarm3{font-size:16px; display:none;}
	.alarm .alarm4{float:right; font-size:14px; padding-right:10px;}
	.alarmType{height:30px; line-height:30px;}
	.alarmType a{display:inline-block}
	.alarmType1{width:100px; text-align:justify; font-size:16px; }
	.alarmType2{width:200px;text-align:left; font-size:16px; color:#FF9900}
	#hours{width:200px; height:30px;}
	.set{height:30px; line-height:30px; margin-bottom:10px;}
	.set *{display:inline-block; vertical-align:middle;}
  </style>
</head>
<!-- ADD THE CLASS layout-boxed TO GET A BOXED LAYOUT -->
<body class="hold-transition skin-blue sidebar-mini sidebar-collapse">
<!-- Site wrapper -->
<div class="wrapper" id="rrapp" v-cloak>
  <header class="main-header">
    <a href="javascript:void(0);" class="logo">
      <!-- mini logo for sidebar mini 50x50 pixels -->
      <span class="logo-mini"><img src="${request.contextPath}/statics/img/icon2.png" width="30px" height="30px"/></span>
      <!-- logo for regular state and mobile devices -->
      <span class="logo-lg"><img src="${request.contextPath}/statics/img/icon2.png" width="30px" height="30px"/>&nbsp;&nbsp;<b>生产监控</b></span>
    </a>
    <!-- Header Navbar: style can be found in header.less -->
    <nav class="navbar navbar-static-top" role="navigation">
      <!-- Sidebar toggle button-->
      <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
        <span class="sr-only">Toggle navigation</span>
      </a>
	  <!-- <div style="float:left;color:#fff;padding:15px 10px;">欢迎 {{user.username}}</div> -->
      <div class="navbar-custom-menu">
        <ul class="nav navbar-nav">
        	<li><a href="http://192.168.101.10:8080/BasePlatForm/win10Menu.html"><i class="fa fa-home"></i></a></li>
		  <!-- <li><a href="javascript:;" @click="updatePassword"><i class="fa fa-lock"></i> &nbsp;修改密码</a></li>
          <li><a href="http://192.168.101.10:8080/BasePlatForm/out"><i class="fa fa-sign-out"></i> &nbsp;退出系统</a></li> -->
		</ul>
      </div>
    </nav>
  </header>

  <!-- =============================================== -->

  <!-- Left side column. contains the sidebar -->
  <aside class="main-sidebar">
    <!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar">
      <!-- /.search form -->
      <!-- sidebar menu: : style can be found in sidebar.less -->
      <ul class="sidebar-menu">
      	<!-- vue生成的菜单 -->
		<menu-item :item="item" v-for="item in menuList"></menu-item>
      </ul>
    </section>
    <!-- /.sidebar -->
  </aside>
  <!-- =============================================== -->
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <ol class="breadcrumb" id="nav_title" style="position:static;float:none;">
        <li class="active"><i class="fa fa-home" style="font-size:20px;position:relative;top:2px;left:-3px;"></i> &nbsp; 生产监控</li>
        <li class="active">{{navTitle}}</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content" style="background:#fff;">
      <iframe scrolling="yes" frameborder="0" style="width:100%;min-height:200px;overflow:visible;background:#fff;" :src=main></iframe>
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
  
  <!-- 修改密码 -->
<div id="passwordLayer" style="display: none;">
	<form class="form-horizontal">
	<div class="form-group">
		<div class="form-group">
		   	<div class="col-sm-2 control-label">账号</div>
		    <span class="label label-success" style="vertical-align: bottom;">{{user.username}}</span>
		</div>
		<div class="form-group">
		   	<div class="col-sm-2 control-label">原密码</div>
		   	<div class="col-sm-10">
		      <input type="password" class="form-control" v-model="password" placeholder="原密码"/>
		    </div>
		</div>
		<div class="form-group">
		   	<div class="col-sm-2 control-label">新密码</div>
		   	<div class="col-sm-10">
		      <input type="text" class="form-control" v-model="newPassword" placeholder="新密码"/>
		    </div>
		</div>
	</div>
	</form>
</div>

<div id="lay" style="display:none;">
<p class="tipName" id="AsiteName">张芝无负压泵站</p>
<p class="alarm"><a class="alarm1" id="Aparam">余氯</a><a class="alarm2" id="Avalue">0.0</a><a class="alarm3" id="Aunit">mg/l</a><a class="alarm4" id="Atime">2020-07-29 15:52</a></p>
<p class="alarmType"><a class="alarmType1">报警类型：</a><a class="alarmType2" id="Atype">报警上限</a></p>
<p class="alarmType"><a class="alarmType1">报警参考值：</a><a class="alarmType2" id="AtypeValue">0.3</a><a id="Aunit2" style=" display:none;">mg/l</a></p>
<div class="set">
<select id="hours">
  <!-- option value="0">本次关闭</option> -->
  <option value="2">2个小时内不再报警</option>
  <option value="999">本日不再报警</option>
</select>
<button type="button" onClick="insertIgnore()" class="layui-btn layui-btn-normal  layui-btn-sm">确定</button>
</div>
<div id="pg"></div>
</div>

</div>
<!-- ./wrapper -->

<script src="${request.contextPath}/statics/libs/jquery.min.js"></script>
<script src="${request.contextPath}/statics/libs/vue.min.js"></script>
<script src="${request.contextPath}/statics/libs/router.js"></script>
<script src="${request.contextPath}/statics/libs/bootstrap.min.js"></script>
<script src="${request.contextPath}/statics/libs/app.js"></script>
<script src="${request.contextPath}/statics/plugins/layui/layui.js"></script>
<script src="${request.contextPath}/statics/js/index.js"></script>
<script>
</script>
<script>
window.onload = function(){
	queryInsAlarm();
	setInterval(queryInsAlarm,300000);
}
function queryInsAlarm() {
    $.ajax({
	    type: "GET",
	    url: "monitor/data/alarmWindow",
	    contentType: "application/json",
	    data: JSON.stringify(),
	    success: function(r){
	        console.log(r);
	        vm.alarmList = JSON.parse(r).list;
	        vm.alarmListLength = vm.alarmList.length*10;
	    	layui.use(['layer', 'laypage'], function(){
	    		var layer = layui.layer;
	    		var laypage = layui.laypage;
	    		 layer.open({
	    		        type: 1, //因为layer弹出层需要一个页面，所以是iframe弹出层，因此type: 2。
	    		        title: ["报警",'color:#fff;background-color:#1997eb;font-size'],
	    		        shadeClose: false,
	    		        shade: 0,
	    		        area: ['350px', '300px'],
	    		        content: $("#lay"),
	    		        anim:2,
	    		        offset:"rb",
	    		        //btn: ['确定', '关闭'],
	    		        yes: function (index) {
	    		            var res = window["layui-layer-iframe" + index].callbackdata();
	    		            var obj = JSON.parse(res);
	    		            var passengerName = obj.Name;
	    		            var passengerCertificate = obj.Certificate;
	    		            var passengerCertificateNum = obj.CertificateNum;
	    		            var passengerBirthday = obj.Birthday;
	    		            var passengerSex = obj.Sex;
	    		            if (passengerName.length > 0 && passengerCertificateNum.length > 0 && passengerBirthday.length > 0 && parseInt(passengerSex)>0) {
	    		                
	    		                layer.close(index);
	    		            }
	    		            else {
	    		                layer.alert('请填写必输项。', {
	    		                    skin: 'layui-layer-molv',
	    		                    closeBtn: 0
	    		                });
	    		            }   
	    		        },
	    		        cancel: function () {
	    		            //右上角关闭回调
	    		        }
	    		    });
	    		  //自定义首页、尾页、上一页、下一页文本
	    /* 		 	laypage.render({
	    			    elem: 'pg'
	    			    ,count: 50
	    			    ,theme: '#1E9FFF'
	    			    ,layout: ['prev', 'next']
	    			    ,jump: function(obj, first){
	    			      if(!first){
	    			        layer.msg('第 '+ obj.curr +' 页');
	    			      }
	    			    }
	    			  }); */
	    			  
	    		 	  laypage.render({
	    		 		    elem: 'pg'
	    		 		    ,count: vm.alarmListLength
	    		 		    ,layout: ['prev', 'next', 'skip']
	    		 		    ,jump: function(obj){
	    		 		      console.log(obj)
	    		 		      var num = (obj.curr-1);
								vm.currentPG = num;
	    		 		    	var unit = "单位";
	    		 		    	var param = "类型";
	    		 		    	var typeValue;
	    		 		    	if(vm.alarmList[num].param=="FLS"){
	    		 		    		unit="m³/h";
	    		 		    		param="流量";
	    		 				}else if(vm.alarmList[num].param=="PTOUT"){
	    		 		    		unit="MPa";
	    		 		    		param="出口压力";
	    		 				}else if(vm.alarmList[num].param=="HOCL"){
	    		 		    		unit="mg/L";
	    		 		    		param="余氯";
	    		 				}else if(vm.alarmList[num].param=="PH"){
	    		 		    		unit="";
	    		 		    		param="pH";
	    		 				}else if(vm.alarmList[num].param=="TUR"){
	    		 		    		unit="mg/L";
	    		 		    		param="TUR";
	    		 				}else if(vm.alarmList[num].param=="COD"){
	    		 		    		unit="mg/L";
	    		 		    		param="COD";
	    		 				}else if(vm.alarmList[num].param=="TN"){
	    		 		    		unit="mg/L";
	    		 		    		param="总氮";
	    		 				}else if(vm.alarmList[num].param=="TP"){
	    		 		    		unit="mg/L";
	    		 		    		param="总磷";
	    		 				}else if(vm.alarmList[num].param=="SS"){
	    		 		    		unit="m³/h";
	    		 		    		param="SS";
	    		 				}else{
	    		 					unit = "";
	    		 					param = vm.alarmList[num].param
	    		 				}
	    		 		    	
	    		 		    	if(vm.alarmList[num].type == "报警上限值"){
	    		 		    		typeValue = vm.alarmList[num].high;
	    		 		    	}
	    		 		    	else if(vm.alarmList[num].type == "故障上限值"){
	    		 		    		typeValue = vm.alarmList[num].higher;
	    		 		    	}
	    		 		    	else if(vm.alarmList[num].type == "报警下限值"){
	    		 		    		typeValue = vm.alarmList[num].low;
	    		 		    	}
	    		 		    	else if(vm.alarmList[num].type == "故障下限值"){
	    		 		    		typeValue = vm.alarmList[num].lower;
	    		 		    	}else{
	    		 		    	}
	    		 		        $("#AsiteName").text(vm.alarmList[num].siteName);
	    		 		        $("#Aparam").text(param);
	    		 		        $("#Avalue").text(vm.alarmList[num].value);
	    		 		        $("#Aunit").text(unit);
	    		 		        $("#Aunit2").text(unit);
	    		 		        $("#Atime").text(vm.alarmList[num].time);
	    		 		        $("#Atype").text(vm.alarmList[num].type);
	    		 		        $("#AtypeValue").text(typeValue);
	    		 		      //monitor/data/insertIgnore

	    		 		    }
	    		 		  });
	    	})
	    	var unit = "单位";
	    	var param = "类型";
	    	var typeValue;
	    	if(vm.alarmList[0].param=="FLS"){
	    		unit="m³/h";
	    		param="瞬时流量";
			}else if(vm.alarmList[0].param=="PTOUT"){
	    		unit="MPa";
	    		param="出口压力";
			}else if(vm.alarmList[0].param=="FLC"){
	    		unit="m³";
	    		param="累计流量";
			}else if(vm.alarmList[0].param=="HOCL"){
	    		unit="mg/L";
	    		param="余氯";
			}else if(vm.alarmList[0].param=="PH"){
	    		unit="";
	    		param="pH";
			}else if(vm.alarmList[0].param=="TUR"){
	    		unit="mg/L";
	    		param="TUR";
			}else if(vm.alarmList[0].param=="COD"){
	    		unit="m³/h";
	    		param="COD";
			}else if(vm.alarmList[0].param=="TN"){
	    		unit="mg/L";
	    		param="总氮";
			}else if(vm.alarmList[0].param=="TP"){
	    		unit="mg/L";
	    		param="总磷";
			}else if(vm.alarmList[0].param=="SS"){
	    		unit="m³/h";
	    		param="悬浮物";
			}else if(vm.alarmList[0].param=="LEVEL"){
	    		unit="m";
	    		param="液位";
			}else{
				unit = "";
				param = vm.alarmList[0].param
			}
	    	
	    	if(vm.alarmList[0].type == "报警上限值"){
	    		typeValue = vm.alarmList[0].high;
	    	}
	    	else if(vm.alarmList[0].type == "故障上限值"){
	    		typeValue = vm.alarmList[0].higher;
	    	}
	    	else if(vm.alarmList[0].type == "报警下限值"){
	    		typeValue = vm.alarmList[0].low;
	    	}
	    	else if(vm.alarmList[0].type == "故障下限值"){
	    		typeValue = vm.alarmList[0].lower;
	    	}else{
	    	}
	        $("#AsiteName").text(vm.alarmList[0].siteName);
	        $("#Aparam").text(param);
	        $("#Avalue").text(vm.alarmList[0].value);
	        $("#Aunit").text(unit);
	        $("#Aunit2").text(unit);
	        $("#Atime").text(vm.alarmList[0].time);
	        $("#Atype").text(vm.alarmList[0].type);
	        $("#AtypeValue").text(typeValue);
	    }
	});
/*     $.ajax({
	    type: "POST",
	    url: "fac/data/queryInsAlarm",
	    contentType: "application/json",
	    data: JSON.stringify(),
	    success: function(r){
	        console.log(r);
	    }
	}); */
}
function insertIgnore(){
	var obj={
	  siteId:vm.alarmList[vm.currentPG].siteId,
	  type:vm.alarmList[vm.currentPG].param,
	  hours:$("#hours").val()
	}
	$.ajax({
	    type: "post",
	    url: "monitor/data/insertIgnore",
	    contentType: "application/json",
	    data: JSON.stringify(obj),
	    success: function(r){
	        console.log(r);
	        if(r == "true"){
	    		layer.msg("完成&nbsp;&nbsp;"+$("#hours").find("option:selected").text()+"&nbsp;&nbsp;设置！");
	        	queryInsAlarm();
	        }
	    }
	}); 
}
</script>
</body>
</html>
